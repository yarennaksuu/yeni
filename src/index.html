<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDR Kill Switch - Process Monitor & Control</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 30px 24px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo h1 {
            color: #ff6b35;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .logo p {
            color: #999;
            font-size: 14px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            color: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 16px;
        }

        .nav-item:hover {
            background: rgba(255, 107, 53, 0.1);
            color: #ff6b35;
        }

        .nav-item.active {
            background: #ff6b35;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 20px;
        }

        .sidebar-footer {
            padding: 20px 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 30px 40px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h2 {
            font-size: 28px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .header p {
            color: #999;
            font-size: 16px;
        }

        .content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 107, 53, 0.3);
        }

        .card h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ff6b35;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #999;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Process Scanner */
        .scanner-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .scanner-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .scanner-controls {
            display: flex;
            gap: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff6b35, #ff8c42);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #e55a2b, #ff7730);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
            color: white;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #ff5252);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Process List */
        .process-list {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            overflow: hidden;
        }

        .process-header {
            background: rgba(255, 255, 255, 0.1);
            padding: 16px 24px;
            display: grid;
            grid-template-columns: 60px 1fr 200px 100px 120px;
            gap: 16px;
            font-weight: 600;
            font-size: 14px;
            color: #ff6b35;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .process-item {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: grid;
            grid-template-columns: 60px 1fr 200px 100px 120px;
            gap: 16px;
            align-items: center;
            transition: all 0.2s ease;
        }

        .process-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .process-item:last-child {
            border-bottom: none;
        }

        .process-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin: 0 auto;
        }

        .status-safe { background: #28a745; }
        .status-threat { background: #dc3545; animation: pulse 2s infinite; }
        .status-unknown { background: #6c757d; }

        .process-name {
            font-weight: 500;
            color: #fff;
        }

        .process-path {
            color: #999;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .process-pid {
            color: #ccc;
            font-family: 'Courier New', monospace;
        }

        .kill-btn {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        /* Logs Section */
        .logs-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 32px;
        }

        .logs-container {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
        }

        .log-info { color: #17a2b8; }
        .log-warning { color: #ffc107; }
        .log-error { color: #dc3545; }
        .log-success { color: #28a745; }

        .timestamp {
            color: #666;
            margin-right: 12px;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 107, 53, 0.2);
            border-top: 4px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
            }
            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 10px 0;
            }
            .nav-item {
                min-width: 120px;
                flex-shrink: 0;
            }
            .content {
                padding: 20px;
            }
            .process-header, .process-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <app-root></app-root>
        <div class="sidebar">
            <div class="logo">
                <h1>EDR Kill Switch</h1>
                <p>Process Monitor & Control</p>
            </div>
            
            <div class="nav-menu">
                <button class="nav-item active" onclick="switchTab('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </button>
                <button class="nav-item" onclick="switchTab('scanner')">
                    <span class="nav-icon">üîç</span>
                    <span>Process Scanner</span>
                </button>
                <button class="nav-item" onclick="switchTab('policies')">
                    <span class="nav-icon">üõ°Ô∏è</span>
                    <span>Policies</span>
                </button>
                <button class="nav-item" onclick="switchTab('logs')">
                    <span class="nav-icon">üìã</span>
                    <span>System Logs</span>
                </button>
                <button class="nav-item" onclick="switchTab('logs')">
                    <span class="nav-icon">üìã</span>
                    <span>Settings</span>
                </button>
            </div>
            
            <div class="sidebar-footer">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span id="systemStatus">System Active</span>
                </div>
                <div style="color: #666; font-size: 12px;">
                    <div>Version 1.0.0</div>
                    <div>Build 2024.08.28</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2 id="pageTitle">Dashboard</h2>
                <p id="pageSubtitle">System overview and statistics</p>
            </div>

            <div class="content">
                <!-- Dashboard Tab -->
                <div id="dashboardTab" class="tab-content">
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>Total Processes</h3>
                            <div class="stat-value" id="totalProcesses">0</div>
                            <div class="stat-label">Currently Running</div>
                        </div>
                        <div class="card">
                            <h3>Threats Detected</h3>
                            <div class="stat-value" id="threatsDetected" style="color: #dc3545;">0</div>
                            <div class="stat-label">Security Alerts</div>
                        </div>
                        <div class="card">
                            <h3>Processes Terminated</h3>
                            <div class="stat-value" id="processesKilled" style="color: #28a745;">0</div>
                            <div class="stat-label">Successfully Stopped</div>
                        </div>
                        <div class="card">
                            <h3>System Uptime</h3>
                            <div class="stat-value" id="systemUptime">0h 0m</div>
                            <div class="stat-label">Monitoring Active</div>
                        </div>
                    </div>
                </div>

                <!-- Scanner Tab -->
                <div id="scannerTab" class="tab-content" style="display: none;">
                    <div class="scanner-section">
                        <div class="scanner-header">
                            <h3>Process Scanner</h3>
                            <div class="scanner-controls">
                                <button class="btn btn-primary" onclick="startScan()">
                                    <span id="scanButtonText">Start Scan</span>
                                </button>
                                <button class="btn btn-secondary" onclick="refreshProcesses()">Refresh</button>
                                <button class="btn btn-danger" onclick="killAllThreats()">Kill All Threats</button>
                            </div>
                        </div>

                        <div class="loading" id="loadingIndicator">
                            <div class="spinner"></div>
                            <p>Scanning processes...</p>
                        </div>

                        <div class="process-list">
                            <div class="process-header">
                                <div>Status</div>
                                <div>Process Name</div>
                                <div>Path</div>
                                <div>PID</div>
                                <div>Action</div>
                            </div>
                            <div id="processListContainer">
                                <!-- Process items will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Policies Tab -->
                <div id="policiesTab" class="tab-content" style="display: none;">
                    <div class="card">
                        <h3>Policy Configuration</h3>
                        <p>Manage blacklist and whitelist rules for process monitoring.</p>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary">Add Blacklist Rule</button>
                            <button class="btn btn-secondary">Add Whitelist Rule</button>
                        </div>
                    </div>
                </div>

                <!-- Logs Tab -->
                <div id="logsTab" class="tab-content" style="display: none;">
                    <div class="logs-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <h3>System Logs</h3>
                            <button class="btn btn-secondary" onclick="clearLogs()">Clear Logs</button>
                        </div>
                        <div class="logs-container" id="logsContainer">
                            <!-- Log entries will be populated here -->
                        </div>
                    </div>
                </div>
                 <!-- Settings Tab -->
<div id="settingsTab" class="tab-content" style="display:none;">
  <div class="settings-grid">
    
    <div class="card">
      <h3>Theme</h3>
      <select id="themeSelect">
        <option value="system">System</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
      </select>
    </div>

    <div class="card">
      <h3>Language</h3>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="tr">T√ºrk√ße</option>
      </select>
    </div>

    <div class="card">
      <h3>Notifications</h3>
      <label><input type="checkbox" id="notifEnabled" checked> Enable</label><br>
      <label><input type="checkbox" id="notifSound" checked> Sound</label><br>
      <label><input type="checkbox" id="notifNative" checked> Native</label>
    </div>

    <div class="card">
      <h3>Application</h3>
      <label>Auto Refresh Interval:
        <input type="number" id="autoRefresh" value="30"> sec
      </label><br>
      <label>Scan Timeout:
        <input type="number" id="scanTimeout" value="5000"> ms
      </label><br>
      <label><input type="checkbox" id="confirmActions" checked> Confirm Actions</label><br>
      <label><input type="checkbox" id="showProcesses"> Show System Processes</label>
    </div>

  </div>
</div>

            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentTab = 'dashboard';
        let isScanning = false;
        let processes = [];
        let stats = {
            totalProcesses: 0,
            threatsDetected: 0,
            processesKilled: 0,
            uptime: 0
        };

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').style.display = 'block';
            
            // Add active class to selected nav item
            event.target.closest('.nav-item').classList.add('active');
            
            // Update header
            const titles = {
                dashboard: 'Dashboard',
                scanner: 'Process Scanner',
                policies: 'Policy Configuration',
                logs: 'System Logs'
            };
            
            const subtitles = {
                dashboard: 'System overview and statistics',
                scanner: 'Real-time process monitoring and control',
                policies: 'Manage blacklist and whitelist rules',
                logs: 'View system activity and events'
            };
            
            document.getElementById('pageTitle').textContent = titles[tabName];
            document.getElementById('pageSubtitle').textContent = subtitles[tabName];
            currentTab = tabName;
        }

        // Mock Tauri invoke function
        async function invoke(command, args = {}) {
            console.log(`Tauri command: ${command}`, args);
            
            // Simulate API delay
            await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));
            
            switch (command) {
                case 'get_process_list':
                    return generateMockProcesses();
                case 'kill_process':
                    return handleKillProcess(args.pid, args.name);
                case 'get_system_stats':
                    return stats;
                default:
                    return { success: true };
            }
        }

        // Generate mock process data
        function generateMockProcesses() {
            const processNames = [
                'System', 'chrome.exe', 'notepad.exe', 'explorer.exe', 'svchost.exe',
                'malware.exe', 'trojan.exe', 'winlogon.exe', 'csrss.exe', 'lsass.exe',
                'firefox.exe', 'code.exe', 'cmd.exe', 'powershell.exe', 'services.exe'
            ];
            
            const threats = ['malware.exe', 'trojan.exe'];
            
            return processNames.map((name, index) => {
                const isThreat = threats.includes(name);
                return {
                    pid: 1000 + index,
                    name: name,
                    path: `C:\\Windows\\System32\\${name}`,
                    is_blacklisted: isThreat,
                    is_whitelisted: !isThreat && ['System', 'csrss.exe', 'lsass.exe'].includes(name),
                    matched_rule: isThreat ? 'malware_pattern' : null,
                    cpu_usage: Math.random() * 10,
                    memory_usage: Math.floor(Math.random() * 1000000),
                    status: 'running'
                };
            });
        }

        // Handle process termination
        async function handleKillProcess(pid, name) {
            addLog('info', `Attempting to terminate ${name} (PID: ${pid})`);
            
            // Simulate kill operation
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (Math.random() > 0.1) { // 90% success rate
                addLog('success', `Successfully terminated ${name} (PID: ${pid})`);
                stats.processesKilled++;
                return { success: true };
            } else {
                addLog('error', `Failed to terminate ${name} (PID: ${pid}): Access denied`);
                throw new Error('Access denied');
            }
        }

        // Scan processes
        async function startScan() {
            if (isScanning) return;
            
            isScanning = true;
            document.getElementById('scanButtonText').textContent = 'Scanning...';
            document.getElementById('loadingIndicator').style.display = 'block';
            
            try {
                addLog('info', 'Starting process scan...');
                
                const processData = await invoke('get_process_list');
                processes = processData;
                
                // Update statistics
                stats.totalProcesses = processes.length;
                stats.threatsDetected = processes.filter(p => p.is_blacklisted).length;
                
                updateDashboard();
                displayProcesses(processes);
                
                addLog('success', `Scan completed. Found ${processes.length} processes, ${stats.threatsDetected} threats detected.`);
                
            } catch (error) {
                addLog('error', `Scan failed: ${error.message}`);
            } finally {
                isScanning = false;
                document.getElementById('scanButtonText').textContent = 'Start Scan';
                document.getElementById('loadingIndicator').style.display = 'none';
            }
        }

        // Refresh processes
        async function refreshProcesses() {
            addLog('info', 'Refreshing process list...');
            await startScan();
        }

        // Kill all detected threats
        async function killAllThreats() {
            const threats = processes.filter(p => p.is_blacklisted);
            
            if (threats.length === 0) {
                addLog('info', 'No threats detected to terminate');
                return;
            }
            
            if (!confirm(`This will attempt to terminate ${threats.length} threat(s). Continue?`)) {
                return;
            }
            
            addLog('warning', `Starting mass termination of ${threats.length} threats...`);
            
            for (const threat of threats) {
                try {
                    await invoke('kill_process', { pid: threat.pid, name: threat.name });
                } catch (error) {
                    console.error(`Failed to kill ${threat.name}:`, error);
                }
            }
            
            // Refresh process list after killing threats
            setTimeout(() => refreshProcesses(), 2000);
        }

        // Kill individual process
        async function killProcess(pid, name) {
            if (!confirm(`Terminate ${name} (PID: ${pid})?`)) {
                return;
            }
            
            try {
                await invoke('kill_process', { pid, name });
                // Remove process from local list
                processes = processes.filter(p => p.pid !== pid);
                displayProcesses(processes);
                updateDashboard();
            } catch (error) {
                console.error('Kill process failed:', error);
            }
        }

        // Display processes in table
        function displayProcesses(processList) {
            const container = document.getElementById('processListContainer');
            
            if (processList.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">No processes found</div>';
                return;
            }
            
            container.innerHTML = processList.map(process => {
                let statusClass = 'status-unknown';
                let statusTitle = 'Unknown';
                
                if (process.is_whitelisted) {
                    statusClass = 'status-safe';
                    statusTitle = 'Whitelisted';
                } else if (process.is_blacklisted) {
                    statusClass = 'status-threat';
                    statusTitle = 'Threat Detected';
                }
                
                return `
                    <div class="process-item">
                        <div class="process-status ${statusClass}" title="${statusTitle}"></div>
                        <div>
                            <div class="process-name">${process.name}</div>
                            ${process.matched_rule ? `<div style="font-size: 12px; color: #ff6b35;">Rule: ${process.matched_rule}</div>` : ''}
                        </div>
                        <div class="process-path">${process.path || 'N/A'}</div>
                        <div class="process-pid">${process.pid}</div>
                        <div>
                            <button class="btn kill-btn btn-danger" onclick="killProcess(${process.pid}, '${process.name}')" 
                                    ${process.is_whitelisted ? 'disabled title="Protected process"' : ''}>
                                ${process.is_whitelisted ? 'Protected' : 'Terminate'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update dashboard statistics
        function updateDashboard() {
            document.getElementById('totalProcesses').textContent = stats.totalProcesses;
            document.getElementById('threatsDetected').textContent = stats.threatsDetected;
            document.getElementById('processesKilled').textContent = stats.processesKilled;
            
            // Update uptime (mock)
            const hours = Math.floor(stats.uptime / 3600);
            const minutes = Math.floor((stats.uptime % 3600) / 60);
            document.getElementById('systemUptime').textContent = `${hours}h ${minutes}m`;
        }

        // Add log entry
        function addLog(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('logsContainer');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 100 log entries
            while (logContainer.children.length > 100) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        // Clear logs
        function clearLogs() {
            if (confirm('Clear all log entries?')) {
                document.getElementById('logsContainer').innerHTML = '';
                addLog('info', 'Log history cleared');
            }
        }

        // Initialize application
        function init() {
            addLog('info', 'EDR Kill Switch initialized');
            addLog('info', 'System monitoring active');
            
            // Start uptime counter
            setInterval(() => {
                stats.uptime += 1;
                updateDashboard();
            }, 1000);
            
            // Auto-refresh processes every 30 seconds when scanner tab is active
            setInterval(() => {
                if (currentTab === 'scanner' && !isScanning) {
                    refreshProcesses();
                }
            }, 30000);
            
            updateDashboard();
        }

        // Start application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>